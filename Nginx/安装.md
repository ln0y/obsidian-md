---
aliases: []
tags: ['Nginx', 'date/2022-09', 'year/2022', 'month/09']
date: 2022-09-06-星期二 18:02:41
update: 2022-09-06-星期二 18:32:17
---

## 系统二进制源安装

[官方二进制源安装方式](http://nginx.org/en/linux_packages.html#instructions)

在 Ubuntu/Debian 系

```shell
sudo apt update
sudo apt install nginx
```

或者 RedHat/CentOS 系

```shell
sudo yum install nginx
```

这种方式最简单的，最快捷的方式，但是不是最好的方式，下面我们来说这种主要问题。

优点

- 所有安装二进制依赖已经处理好了，不用担心兼容性问题，开箱即用
- Nginx 的连接配置，用户权限这个都不用处理，已经帮你写好这块了
- 不用担心 Nginx Bug 维护升级问题，直接获取最新系统就可以了
- 卸载简单，直接一个命令即可
- 日志维护简单，自动截断当天日志，压缩保存

缺点

- 不能自主选择安装版本
- 不能自主选择编译的模块
- 扩展功能变得很麻烦，需要重新编译
- 目类结构复杂，配置文件在 `/etc/` 下，部署文件在 `/var/www`
- 重启服务，修改配置都需要 root 权限
- 性能差一点编译安装

如果你是一个 Linux 新手，绝对推荐使用这中方式安装，不用考虑编译依赖问题，直接安装完就可以使用。但是如果你这个服务器是用于生产环境正在开发逐步完善的过程，不推荐使用这种方式。将来可能会添加第三方模块，到时肯定要编译安装 。在重启服务器的时候，不要使用 root 用户，而是使用 `sudo` 短暂获取 root。如果你这条服务器都是用来部署一些静态文件，主要做一些 web 空间，平常主要用 ftp 工具部署文件，用这种方式肯定没什么问题的。

## 编译安装

基本就是上面的颠倒过来就可以了。使用这种方法安装，都必须懂一点 Linux 编译知识，Linux 中度用户才可以驾驭。我看见网上大多数教程，都是将编译依赖直接装在 `/usr/local/` 这种方式并不好。如果将来我们要卸载这些依赖，发现非常麻烦。并不是直接在目类下直接删除就可以完事的，有些 Linux 发行版本，会将安装文件，写入配置文件中，这些配置文件有不知道哪里找。如果依赖版本影响到其他软件，怎么处理版本问题。我们只想安装 Nginx，结果延申出一大堆问题。

### 安装依赖

安装 nginx 之前，确保系统已经安装 gcc、openssl-devel、pcre-devel 和 zlib-devel 软件库

**1、安装 gcc**

安装 nginx 需要先将官网下载的源码进行编译，编译依赖 gcc 环境，如果没有 gcc 环境，则需要安装：

```shell
yum install gcc
```

**2、PCRE pcre-devel 安装**

PCRE(Perl Compatible Regular Expressions) 是一个 Perl 库，包括 perl 兼容的正则表达式库。nginx 的 http 模块使用 pcre 来解析正则表达式，所以需要在 linux 上安装 pcre 库，pcre-devel 是使用 pcre 开发的一个二次开发库。nginx 也需要此库。命令：

```shell
yum install -y pcre pcre-devel
```

**3、zlib 安装**

zlib 库提供了很多种压缩和解压缩的方式， nginx 使用 zlib 对 http 包的内容进行 gzip ，所以需要在 Centos 上安装 zlib 库。

```shell
yum install -y zlib zlib-devel
```

**4、OpenSSL 安装**

OpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议，并提供丰富的应用程序供测试或其它目的使用。 nginx 不仅支持 http 协议，还支持 https（即在 ssl 协议上传输 http），所以需要在 Centos 安装 OpenSSL 库。

```shell
yum install -y openssl openssl-devel
```

#### CentOS

```shell
yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel
```

#### Ubuntu

```shell
sudo apt-get update
sudo apt-get install gcc zlib1g zlib1g-dev libpcre3-dev openssl libssl-dev
```

### 下载

http://nginx.org/en/download.html

![](_attachment/img/Pasted image 20220906180653.png|700)

```shell
wget http://nginx.org/download/nginx-1.23.1.tar.gz
```

### 编译选项

使用 `./configure` 设置各种 Nginx 参数的脚本，包括源和配置文件的路径，编译器选项，连接处理方法和模块列表。该脚本通过创建编译代码和安装 Nginx 开源所需的 Makefile 来完成。

| 参数                      | 描述                                                                                                                                                    |
| ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| \--prefix=\<PATH>         | Nginx 安装目录，以及有其他配置脚本选项的路径设置的所有相对路径的基本位置。默认值 `/usr/local/nginx`                                                     |
| \--sbin-path=\<PATH>      | Nginx 二进制执行文件的名称，默认值:`<prefix>/sbin/nginx`                                                                                                |
| \--conf-path=\<PATH>      | Nginx 配置文件的名称。但是，您可以通过在 nginx 命令行上使用选项指定其他文件来始终在启动时覆盖此值。默认值：`<prefix> conf / nginx.conf-c <FILENAME>`    |
| \--pid-path=\<PATH>       | nginx.pid 文件的名称，用于存储 nginx 主进程的进程 ID 。安装后，可以使用 Nginx 配置文件中的 pid 指令更改文件名的路径。默认值：`<prefix> /logs/nginx.pid` |
| \--error-log-path=\<PATH> | error，warn 和诊断数据的日志文件的名称。安装后，可以使用 Nginx 配置文件中的 error_log 指令更改文件名。默认值：`<prefix> /logs/error.log`                |
| \--http-log-path=\<PATH>  | HTTP 服务器请求的主日志文件的名称。安装后，始终可以使用 Nginx 配置文件中的 access_log 指令更改文件名。默认值：`<prefix> /logs/access.log`               |
| \--user=\<NAME>           | Nginx 运行进程的拥有者。安装后，可以使用 Nginx 配置文件中的 user 指令更改名称。默认：`nobody`                                                           |
| \--group=name             | nginx 运行进程的拥有者用户组。安装后，可以使用 NGINX 配置文件中的 user 指令更改名称。默认值：--user 选项设置的值                                        |
| \--with-pcre=\<PATH>      | PCRE 库源代码的路径，这是位置指令和 Rewrite 模块中正则表达式支持所必需的                                                                                |
| \--with-pcre-jit          | 使用“即时编译”支持（pcre_jit 指令）构建 PCRE 库                                                                                                         |
| \--with-zlib=\<PATH>      | zlib 库的源代码路径，Gzip 模块需要该路径                                                                                                                |
| \--with-http_ssl_modul    | 启用 HTTPS 支持                                                                                                                                         |
| \--with-http_v2_module    | 开启 HTTP/2 请求支持                                                                                                                                    |

[更多参数](https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/#sources)

##### 编译安装

```shell
./configure \
   --with-openssl=../openssl-1.0.2s \
   --with-pcre=../pcre-8.43 \
   --with-zlib=../zlib-1.2.11 \
   --with-pcre-jit --user=admin \
   --prefix=/home/admin/nginx \
   --with-http_ssl_module \
   --with-http_v2_module
```

输出以下信息，说明依赖没问题

```shell
Configuration summary
  + using PCRE library: ../pcre-8.43
  + using OpenSSL library: ../openssl-1.0.2s
  + using zlib library: ../zlib-1.2.11

  nginx path prefix: "/home/admin/nginx"
  nginx binary file: "/home/admin/nginx/sbin/nginx"
  nginx modules path: "/home/admin/nginx/modules"
  nginx configuration prefix: "/home/admin/nginx/conf"
  nginx configuration file: "/home/admin/nginx/conf/nginx.conf"
  nginx pid file: "/home/admin/nginx/logs/nginx.pid"
  nginx error log file: "/home/admin/nginx/logs/error.log"
  nginx http access log file: "/home/admin/nginx/logs/access.log"
  nginx http client request body temporary files: "client_body_temp"
  nginx http proxy temporary files: "proxy_temp"
  nginx http fastcgi temporary files: "fastcgi_temp"
  nginx http uwsgi temporary files: "uwsgi_temp"
  nginx http scgi temporary files: "scgi_temp"
```

编译

```shell
make
```

安装

make install

##### 设置权限

因为 Linux 设置普通用户，不能占用 1024 一下的端口，直接启动 nginx 会出现权限不足的错误。将 nginx 分配给 root 用户，在分配特殊权限。

```shell
sudo chown root nginx
sudo chmod u+s nginx
```
